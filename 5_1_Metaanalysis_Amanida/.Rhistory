basal <- basal %>% filter(ID != "1098_977")
table(basal$`Type of sample (grouped)`)
# BLOOD ####
# Loading require dataframes #
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Serum", "Plasma"))
# Quantitative data (list of proteins by study)
data <- readxl::read_xlsx(path = "../4_Processing/allProcessedProteinData.xlsx",
sheet = "Quantitative (>2 studies)", col_names = T)
df <- data %>% filter(ID %in% c(basalQ$ID, "1027_15_Pla"))
table(df$ID)
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Cheking if there is duplicated protein IDs in each dataset
for (i in unique(df$ID)){
cat(i, ": \t")
cat(any(duplicated(df[which(df$ID == i), "ProteinID"])))
cat("\n")
}
# Finding duplicated proteins #
allFrec <- table(df$ProteinID)
table(allFrec) # 230 proteins únicas, 104 en al menos 2 estudios, 17 en al menos 3 estudios, 3 en 4 estudios
interestingFrec <- allFrec[which(allFrec > 1)]
dfAll <- df
df <- df %>% filter(ProteinID %in% names(interestingFrec)) # Keeping proteins that appears in 2 or more studies #
# Mixing basal info with proteins info #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
# Quantitative data (list of proteins by study)
dataOriginal <- readxl::read_xlsx(path = "../4_Processing/allProcessedProteinData.xlsx",
sheet = "Quantitative (>2 studies)", col_names = T)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
## Selecting relevant data for Amanida metanalysis ####
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving #
write.csv(x = df, file = "../../Data/4_Metanalisis/df_amanida_quantitativo_BLOOD.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
## 2) AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "../../Data/4_Metanalisis/df_amanida_quantitativo_BLOOD.csv", #_AllProts
mode = "quan", coln, separator=",")
datafile <- amanida_read(
file = "df_amanida_quantitativo_BLOOD.csv", #_AllProts
mode = "quan", coln, separator=",")
# Saving #
write.csv(x = df, file = "df_amanida_quantitativo_BLOOD.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
## 2) AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitativo_BLOOD.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
diccionary <- dataOriginal %>%
group_by(ProteinID) %>%
reframe(
Alias = {
valores <- unique(na.omit(ProteinName))
if (length(valores) == 0) as.character(ProteinID[1]) else if (length(valores) == 1) valores else paste(valores, collapse = "; ")
},
.groups = "drop"
) %>%
dplyr::select(ProteinID, Alias)
diccionary <- as.data.frame(diccionary)
rownames(diccionary) <- diccionary$ProteinID
diccionary[which(diccionary$Alias == "-"), "Alias"] <- diccionary[which(diccionary$Alias == "-"), "ProteinID"]
sum(grepl(pattern = "NA;", x = diccionary$Alias, fixed = T)) # aliminar NA;
diccionary$Alias <- gsub(diccionary$Alias, pattern = "NA;", replacement = "", fixed = T)
sdgv
diccionary <- dataOriginal %>%
group_by(ProteinID) %>%
reframe(
Alias = {
valores <- unique(na.omit(ProteinName))
if (length(valores) == 0) as.character(ProteinID[1]) else if (length(valores) == 1) valores else paste(valores, collapse = "; ")
},
.groups = "drop"
) %>%
dplyr::select(ProteinID, Alias)
diccionary <- as.data.frame(diccionary)
rownames(diccionary) <- diccionary$ProteinID
diccionary[which(diccionary$Alias == "-"), "Alias"] <- diccionary[which(diccionary$Alias == "-"), "ProteinID"]
sum(grepl(pattern = "NA;", x = diccionary$Alias, fixed = T)) # aliminar NA;
diccionary$Alias <- gsub(diccionary$Alias, pattern = "NA;", replacement = "", fixed = T)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
## Displaying results ####
volcano_plot(amanida_result, cutoff = c(0.05, 1.5))
##############################################################################-
################    METANALYSIS WITH AMANIDE - BY SAMPLE  #######################-
##############################################################################-
# Julia G Currás - 2025/05/23
rm(list=ls())
graphics.off()
library(dplyr)
library(amanida)
# Basal data
basal <- readxl::read_xlsx(path = "../3_Extraction/Database.xlsx",
sheet = "1. Basal data", col_names = T)
basal <- basal[!(basal$infoPvalue == "No" & basal$infoAdjustedPvalue == "No"), ]
basal <- basal %>% filter(ID != "1098_977")
table(basal$`Type of sample (grouped)`)
# Quantitative data (list of proteins by study)
dataOriginal <- readxl::read_xlsx(path = "../4_Processing/allProcessedProteinData.xlsx",
sheet = "Quantitative (>2 studies)", col_names = T)
# Diccionary
diccionary <- dataOriginal %>%
group_by(ProteinID) %>%
reframe(
Alias = {
valores <- unique(na.omit(ProteinName))
if (length(valores) == 0) as.character(ProteinID[1]) else if (length(valores) == 1) valores else paste(valores, collapse = "; ")
},
.groups = "drop"
) %>%
dplyr::select(ProteinID, Alias)
diccionary <- as.data.frame(diccionary)
rownames(diccionary) <- diccionary$ProteinID
diccionary[which(diccionary$Alias == "-"), "Alias"] <- diccionary[which(diccionary$Alias == "-"), "ProteinID"]
sum(grepl(pattern = "NA;", x = diccionary$Alias, fixed = T)) # aliminar NA;
diccionary$Alias <- gsub(diccionary$Alias, pattern = "NA;", replacement = "", fixed = T)
# 1) BLOOD ####
## Processing data ####
# Selecting dataframes of interest #
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Serum", "Plasma"))
df <- dataOriginal %>% filter(ID %in% c(basalQ$ID, "1027_15_Pla"))
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Finding duplicated proteins #
allFrec <- table(df$ProteinID)
table(allFrec) # 230 proteins únicas, 104 en al menos 2 estudios, 17 en al menos 3 estudios, 3 en 4 estudios
interestingFrec <- allFrec[which(allFrec > 1)]
dfAll <- df
df <- df %>% filter(ProteinID %in% names(interestingFrec)) # Keeping proteins that appears in 2 or more studies #
# Adding N info to protein data for omics-based metaanalysis #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
# Selecting relevant data for Amanida metanalysis #
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving #
write.csv(x = df, file = "df_amanida_quantitativo_BLOOD.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
## AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitativo_BLOOD.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 1.5))
vote_plot(amanida_result, counts = 2)
explore_plot(datafile, type = "sub", counts = 1)
## Saving Blood results ####
xlsx::write.xlsx(x = as.data.frame(amanida_result@stat),
col.names = T, row.names = F, append = F,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "BLOOD - metaanalysis")
xlsx::write.xlsx(x = as.data.frame(amanida_result@vote),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "BLOOD - vote counting")
# Selecting dataframes of interest #
basalQ <- basal %>%
filter(TypeOfSample_2 %in% c("Eye")) #%>% dplyr::select(ID, Reference)
# EYE  ####
# Selecting dataframes of interest #
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Eye")) #%>% dplyr::select(ID, Reference)
df <- dataOriginal %>% filter(Reference %in% basalQ$Reference)
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Finding duplicated proteins #
allFrec <- table(df$ProteinID)
table(allFrec) # 1529 proteins únicas, 625 en al menos 2 estudios, 163 en al menos 3 estudios, 38 en 4 estudios
interestingFrec <- allFrec[which(allFrec > 1)]
dfAll <- df
df <- df %>% filter(ProteinID %in% names(interestingFrec))# Keeping proteins that appears in 2 or more studies #
## Mixing basal info with proteins info ####
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
# Selecting relevant data for Amanida metanalysis #
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
## AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitative_Samples.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 2))
vote_plot(amanida_result, counts = 2)
explore_plot(datafile, type = "sub", counts = 1)
## Saving EYE results ####
xlsx::write.xlsx(x = as.data.frame(amanida_result@stat),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "EYE - metaanalysis")
xlsx::write.xlsx(x = as.data.frame(amanida_result@vote),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "EYE - vote counting")
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Urine"))
df <- dataOriginal %>% filter(Reference %in% basalQ$Reference)
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Duplicated IDs across datasets #
allFrec <- table(df$ProteinID)
table(allFrec) # 1529 proteins únicas, 625 en al menos 2 estudios, 163 en al menos 3 estudios, 38 en 4 estudios
interestingFrec <- allFrec[which(allFrec > 1)]
allFrec <- table(df$ProteinID)
table(allFrec) # 1529 proteins únicas, 625 en al menos 2 estudios, 163 en al menos 3 estudios, 38 en 4 estudios
interestingFrec <- allFrec[which(allFrec > 1)]
dfAll <- df
# df <- df %>% filter(ProteinID %in% names(interestingFrec)) # Keeping proteins that appears in 2 or more studies #
# Adding N info #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
## Selecting relevant data for Amanida metanalysis ####
sum(is.na(data$logFC))
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
# AMANIDA META-ANALYSIS ####
## Open with Amanida ####
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitative_Samples.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 4))
vote_plot(amanida_result, counts = 2)
explore_plot(datafile, type = "sub", counts = 1)
xlsx::write.xlsx(x = as.data.frame(amanida_result@stat),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "URINE - metaanalysis")
xlsx::write.xlsx(x = as.data.frame(amanida_result@vote),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "URINE - vote counting")
# SALIVA ####
## Processing data ####
# Selecting dataframes of interest #
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Saliva")) #%>% dplyr::select(ID, Reference)
df <- dataOriginal %>% filter(ID %in% c(basalQ$ID, "1027_15_Sal"))
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Finding duplicated proteins #
allFrec <- table(df$ProteinID)
table(allFrec) # 230 proteins únicas, 104 en al menos 2 estudios, 17 en al menos 3 estudios, 3 en 4 estudios
dfAll <- df
# Mixing basal info with proteins info #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
## AMANIDA META-ANALYSIS ####
# Open with Amanida
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitative_Samples.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 3))
vote_plot(amanida_result, counts = 2)
explore_plot(datafile, type = "sub", counts = 1)
xlsx::write.xlsx(x = as.data.frame(amanida_result@stat),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "SALIVA - metaanalysis")
xlsx::write.xlsx(x = as.data.frame(amanida_result@vote),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "SALIVA - vote counting")
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Extracellular vesicles (blood)")) #%>% dplyr::select(ID, Reference)
df <- dataOriginal %>% filter(Reference %in% basalQ$Reference)
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Duplicated IDs across datasets #
allFrec <- table(df$ProteinID)
table(allFrec) # 1529 proteins únicas, 625 en al menos 2 estudios, 163 en al menos 3 estudios, 38 en 4 estudios
dfAll <- df
# Mixing basal info with proteins info #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
# Selecting relevant data for Amanida metanalysis #
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv", #_AllProts (df para todas as proteinas sin quedarnos solo coas de al menos en 2 estudios)
sep = ",", row.names = F, col.names = T, quote = F)
## AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitative_Samples.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 6))
xlsx::write.xlsx(x = as.data.frame(amanida_result@stat),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "EV - metaanalysis")
xlsx::write.xlsx(x = as.data.frame(amanida_result@vote),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "EV - vote counting")
df <- dataOriginal %>% filter(Reference %in% basalQ$Reference)
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Duplicated IDs across datasets #
allFrec <- table(df$ProteinID)
table(allFrec) # 284 proteins únicas, 6 en 2 estudios
dfAll <- df
# Adding N info #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
# Selecting relevant data for Amanida metanalysis #
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv",
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv",
sep = ",", row.names = F, col.names = T, quote = F)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv",
sep = ",", row.names = F, col.names = T, quote = F)
## AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitative_Samples.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 2))
vote_plot(amanida_result, counts = 2)
explore_plot(datafile, type = "sub", counts = 1)
basalQ <- basal %>%
filter(`Type of sample (grouped)` %in% c("Visceral Adipose Tissue"))
df <- dataOriginal %>% filter(Reference %in% basalQ$Reference)
table(df$ID)
# Removing proteins without logFc info #
sum(is.na(df$logFC))
df <- df %>% filter(!is.na(logFC))
# Duplicated IDs across datasets #
allFrec <- table(df$ProteinID)
table(allFrec) # 284 proteins únicas, 6 en 2 estudios
dfAll <- df
# Adding N info #
basalQ$TotalN <- basalQ$SampleSizeControls + basalQ$SampleSizeDiabetics
basalQ_2 <- basalQ %>% dplyr::select(Reference, TotalN)
data <- base::merge(df, basalQ_2, by = "Reference", all.x = T, all.y = T)
# Selecting relevant data for Amanida metanalysis #
sum(is.na(data$logFC))
df <- data %>%
filter(!is.na(logFC)) %>%
dplyr::select(ProteinID, pvalAdjFinal, logFC, TotalN, Reference)
df$logFC <- as.numeric(df$logFC)
df$logFC <- 2^df$logFC
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
colnames(df) <- coln
df$References <- gsub(df$References, pattern = ", ", replacement = " ", fixed = T)
# Saving
write.csv(x = df, file = "df_amanida_quantitative_Samples.csv",
sep = ",", row.names = F, col.names = T, quote = F)
## AMANIDA META-ANALYSIS ####
# Open with Amanida #
coln = c("Protein", "AdjPval", "logFC", "N total", "References")
datafile <- amanida_read(
file = "df_amanida_quantitative_Samples.csv", #_AllProts
mode = "quan", coln, separator=",")
# Analyzing... #
amanida_result <- compute_amanida(datafile, comp.inf = F)
# Changing protein ids by protein names
amanida_result@stat$id <- diccionary[amanida_result@stat$id, "Alias"]
amanida_result@vote$id <- diccionary[amanida_result@vote$id, "Alias"]
# Displaying results #
volcano_plot(amanida_result, cutoff = c(0.05, 2))
vote_plot(amanida_result, counts = 2)
explore_plot(datafile, type = "sub", counts = 1)
## Saving quantitative Amanida results ####
output <- list(result = amanida_result, data = datafile, all = dfAll)
xlsx::write.xlsx(x = as.data.frame(amanida_result@stat),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "VAT - metaanalysis")
xlsx::write.xlsx(x = as.data.frame(amanida_result@vote),
col.names = T, row.names = F, append = T,
file = "resultsBySample_Quantitative.xlsx",
sheetName = "VAT - vote counting")
